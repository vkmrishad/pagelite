<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pagelite â€” Blog List</title>

    <!-- Load sql.js (UMD build) -->
    <script src="./assets/js/sql-wasm/1.13.0/sql-wasm.min.js"></script>

    <style>
        body {
            font-family: system-ui, sans-serif;
            padding: 2rem;
            background: #fafafa;
            color: #333;
        }

        header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            object-fit: contain;
        }

        .brand {
            font-size: 1.8rem;
            font-weight: 600;
            color: #0078d7;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #444;
        }

        ul {
            list-style: disc;
            padding-left: 1.5rem;
        }

        li {
            margin: 0.5rem 0;
        }

        a {
            text-decoration: none;
            color: #0078d7;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <header>
        <!-- Replace logo.png with your actual logo path -->
        <span class="brand">Pagelite</span>
    </header>

    <h2>Blog Posts</h2>
    <ul id="blog-list"></ul>

    <script>
        async function loadBlogs() {
            // Initialize SQL.js (global initSqlJs)
            const SQL = await initSqlJs({
                locateFile: file => `./assets/js/sql-wasm/1.13.0/${file}`
            });

            // Load the SQLite database
            const response = await fetch("./blog.db");
            const buffer = await response.arrayBuffer();
            const db = new SQL.Database(new Uint8Array(buffer));

            // Run query
            const result = db.exec("SELECT id, title FROM blogs ORDER BY id DESC;");
            const list = document.getElementById("blog-list");

            if (result.length === 0) {
                list.innerHTML = "<li>No blogs found.</li>";
                return;
            }

            const rows = result[0].values;
            list.innerHTML = rows
                .map(([id, title]) => `<li><a href="post.html?id=${id}">${title}</a></li>`)
                .join("");
        }

        loadBlogs().catch(console.error);
    </script>
</body>

</html>